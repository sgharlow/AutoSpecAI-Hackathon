# Output Formats Documentation

## Overview

The AutoSpec.AI format Lambda function generates structured system requirements in multiple formats to accommodate different use cases and preferences.

## Generated Formats

### 1. Markdown (.md)
**Purpose**: Human-readable documentation format  
**Use Case**: Documentation, version control, collaboration

**Structure**:
```markdown
# System Requirements Analysis

**Document:** filename.pdf  
**Processed:** 2024-01-01 12:00:00 UTC  
**Generated by:** AutoSpec.AI

---

[AI-generated requirements content]

---

## Processing Summary
- Request ID
- Processing Status  
- AI Model Used
- Sections Extracted

## Sections Overview
- Executive Summary
- Functional Requirements
- Non-Functional Requirements
- [Additional sections]
```

### 2. JSON (.json)
**Purpose**: Structured data format for programmatic access  
**Use Case**: API integration, data processing, automation

**Structure**:
```json
{
  "metadata": {
    "request_id": "uuid",
    "filename": "document.pdf",
    "processed_at": "2024-01-01T00:00:00Z",
    "sender_email": "user@example.com",
    "file_type": "pdf",
    "processing_status": "delivered"
  },
  "ai_analysis": {
    "model_used": "anthropic.claude-3-sonnet-20240229-v1:0",
    "generated_at": "2024-01-01T00:00:00Z",
    "processing_status": "completed"
  },
  "requirements": {
    "executive_summary": "...",
    "functional_requirements": "...",
    "non_functional_requirements": "...",
    "stakeholder_roles_and_responsibilities": "...",
    "technical_architecture_considerations": "...",
    "integration_requirements": "...",
    "data_requirements": "...",
    "security_and_compliance": "..."
  },
  "raw_response": "Full AI response text",
  "generated_by": "AutoSpec.AI",
  "format_version": "1.0"
}
```

### 3. HTML (.html)
**Purpose**: Web-viewable format with professional styling  
**Use Case**: Presentations, web sharing, printing

**Features**:
- Professional CSS styling
- Responsive design
- Table formatting
- Print-friendly layout
- AutoSpec.AI branding

### 4. PDF (Optional)
**Purpose**: Portable document format for formal documentation  
**Use Case**: Official documentation, archival, sharing
**Status**: Placeholder implementation (can be extended with weasyprint/reportlab)

## Email Delivery

### Email Template Structure
```
Subject: AutoSpec.AI - System Requirements for [filename]

Dear User,

Your document analysis is complete! AutoSpec.AI has generated 
comprehensive system requirements based on your uploaded document.

Document Details:
- Filename: [document name]
- Processed: [timestamp]
- Request ID: [unique identifier]

The analysis includes:
- Executive Summary
- Functional Requirements
- Non-Functional Requirements
- Stakeholder Roles and Responsibilities
- Technical Architecture Considerations
- Integration Requirements
- Data Requirements
- Security and Compliance

Please find the detailed requirements attached in multiple formats:
- Markdown (.md) - Human-readable text format
- JSON (.json) - Structured data format
- HTML (.html) - Web-viewable format

Best regards,
AutoSpec.AI Team
```

### SES Integration
- **Source Email**: Configurable via FROM_EMAIL environment variable
- **Delivery**: Both text and HTML versions
- **Attachments**: Currently inline HTML; can be extended for file attachments
- **Error Handling**: Comprehensive logging and retry logic

## Processing Pipeline

### 1. Trigger Sources
- **DynamoDB Streams**: Automatic processing when AI analysis completes
- **Direct Invocation**: Manual trigger with request_id parameter

### 2. Data Flow
1. Retrieve completed analysis from DynamoDB
2. Generate formatted outputs in all formats
3. Send email notification with results
4. Store final delivery status and response hash
5. Update processing stage to 'delivery_complete'

### 3. Error Handling
- **Missing Data**: Graceful handling of incomplete analysis
- **Email Failures**: Retry logic and error logging
- **Format Generation**: Individual format failures don't block others
- **Status Tracking**: Comprehensive status updates throughout pipeline

## Storage and Versioning

### DynamoDB Storage
- **Response Hash**: MD5 hash of JSON output for version tracking
- **Metadata**: Output lengths and generation status
- **Delivery Tracking**: Timestamp and delivery confirmation
- **Error Logging**: Detailed error messages for troubleshooting

### Version Control
- **Format Version**: Semantic versioning for output structure
- **Response Hashing**: Detect changes in AI responses
- **Processing Stages**: Track completion of each pipeline stage

## Performance Considerations

### Optimization Features
- **Template Caching**: Jinja2 templates for consistent formatting
- **Lazy PDF Generation**: PDF only generated when specifically requested
- **Efficient Queries**: Optimized DynamoDB access patterns
- **Error Recovery**: Non-blocking error handling

### Scalability
- **Concurrent Processing**: Stateless function design
- **Memory Efficiency**: Streaming for large documents
- **Format Independence**: Each format generated independently
- **Async Delivery**: Non-blocking email delivery

## Security Features

- **Input Validation**: Sanitized template rendering
- **Email Security**: SES integration with AWS security
- **Data Encryption**: AWS service-level encryption
- **Access Control**: IAM-based permissions
- **Content Filtering**: Safe HTML generation